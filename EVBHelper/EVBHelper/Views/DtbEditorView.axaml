<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:EVBHelper.ViewModels.Dtb"
             mc:Ignorable="d"
             x:Class="EVBHelper.Views.DtbEditorView"
             x:DataType="vm:DtbEditorViewModel">
    <Grid RowDefinitions="Auto,*" ColumnDefinitions="2*,3*" RowSpacing="16" ColumnSpacing="16" Margin="0">
        <Border Grid.ColumnSpan="2" Padding="16" CornerRadius="12" Background="{DynamicResource ThemeControlMidBrush}">
            <Grid ColumnDefinitions="3*,2.5*" ColumnSpacing="16">
                <WrapPanel Grid.Column="0" VerticalAlignment="Center">
                    <Button Content="Open DTB"
                            Command="{Binding OpenCommand}"
                            Theme="{DynamicResource SolidButton}"
                            Classes="Secondary"
                            Margin="0,0,8,8" />
                    <Button Content="Save"
                            Command="{Binding SaveCommand}"
                            Theme="{DynamicResource SolidButton}"
                            Classes="Primary"
                            Margin="0,0,8,8" />
            <Button Content="Save As"
                Command="{Binding SaveAsCommand}"
                Theme="{DynamicResource SolidButton}"
                Classes="Secondary"
                Margin="0,0,8,8" />
            <StackPanel Orientation="Horizontal"
                VerticalAlignment="Center"
                Margin="0,0,8,8"
                Spacing="6">
            <TextBlock Text="Current file:" VerticalAlignment="Center" />
                        <TextBox Text="{Binding CurrentFilePath, TargetNullValue='(none)', FallbackValue='(none)'}"
                                 IsReadOnly="True"
                                 MinWidth="220"
                                 HorizontalAlignment="Left"
                                 VerticalAlignment="Center" />
            </StackPanel>
                </WrapPanel>
                <StackPanel Grid.Column="1"
                            Spacing="8"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center">
                    <TextBlock Text="{Binding StatusMessage}"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"
                               TextAlignment="Left" />
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="1" Grid.Column="0" CornerRadius="12" Padding="16" Background="{DynamicResource ThemeControlMidBrush}">
            <Grid RowDefinitions="Auto,*" RowSpacing="10">
                <StackPanel Spacing="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Node name:" VerticalAlignment="Center" />
                        <TextBox Text="{Binding SelectedNode.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="200" IsEnabled="{Binding SelectedNode}" />
                    </StackPanel>
                    <WrapPanel>
                        <TextBox Width="160"
                                 Watermark="New node name"
                                 Text="{Binding NewNodeName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,8,8" />
                        <Button Content="Add child node"
                                Command="{Binding AddNodeCommand}"
                                Theme="{DynamicResource SolidButton}"
                                Classes="Secondary"
                                Margin="0,0,8,8" />
                        <Button Content="Delete node"
                                Command="{Binding RemoveNodeCommand}"
                                Theme="{DynamicResource SolidButton}"
                                Classes="Warning"
                                Margin="0,0,8,8" />
                    </WrapPanel>
                </StackPanel>
        <Border Grid.Row="1"
            Background="{DynamicResource ThemeBackgroundBrush}"
            Padding="10"
            CornerRadius="8">
                    <TreeView
                        ItemsSource="{Binding Nodes}"
                        SelectedItem="{Binding SelectedNode, Mode=TwoWay}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <TreeView.DataTemplates>
                            <TreeDataTemplate ItemsSource="{Binding Children}" DataType="vm:DtbNodeViewModel">
                                <TextBlock Text="{Binding DisplayName}" />
                            </TreeDataTemplate>
                        </TreeView.DataTemplates>
                    </TreeView>
                </Border>
            </Grid>
        </Border>

        <Border Grid.Row="1" Grid.Column="1" CornerRadius="12" Padding="16" Background="{DynamicResource ThemeControlMidBrush}">
            <Grid RowDefinitions="Auto,*" RowSpacing="12">
                <StackPanel Spacing="12">
                    <WrapPanel>
                        <TextBox Width="160"
                                 Watermark="Property name"
                                 Text="{Binding NewPropertyName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,8,8" />
                        <ComboBox Width="140"
                                  SelectedIndex="{Binding NewPropertyModeIndex, Mode=TwoWay}"
                                  Margin="0,0,8,8">
                            <ComboBoxItem Content="Text" />
                            <ComboBoxItem Content="Hex" />
                        </ComboBox>
                        <TextBox Width="260"
                                 TextWrapping="Wrap"
                                 MinHeight="36"
                                 FontFamily="{Binding NewPropertyFontFamily}"
                                 AcceptsReturn="{Binding NewPropertyAcceptsReturn}"
                                 Watermark="{Binding NewPropertyWatermark}"
                                 Text="{Binding NewPropertyValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,8,8" />
                        <Button Content="Add property"
                                Command="{Binding AddPropertyCommand}"
                                Theme="{DynamicResource SolidButton}"
                                Classes="Secondary"
                                Margin="0,0,8,8" />
                        <Button Content="Delete property"
                                Command="{Binding RemovePropertyCommand}"
                                Theme="{DynamicResource SolidButton}"
                                Classes="Warning"
                                Margin="0,0,8,8" />
                    </WrapPanel>
                    <TextBlock Text="Properties" Classes="H5" />
                </StackPanel>
                <Border Grid.Row="1"
                        Background="{DynamicResource ThemeBackgroundBrush}"
                        Padding="12"
                        CornerRadius="8">
                    <ListBox ItemsSource="{Binding SelectedNode.Properties}"
                             SelectedItem="{Binding SelectedProperty, Mode=TwoWay}"
                             BorderThickness="0"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:DtbPropertyViewModel">
                                <Border Padding="6" Margin="0,0,0,6" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="8">
                                    <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="6" ColumnSpacing="10">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                            <Border Background="{DynamicResource ThemeControlMidBrush}"
                                                    Padding="6,2"
                                                    CornerRadius="6">
                                                <TextBlock Text="{Binding Kind}"
                                                           FontSize="11"
                                                           Foreground="{DynamicResource ThemeForegroundBrush}" />
                                            </Border>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1"
                                                    Orientation="Horizontal"
                                                    Spacing="6"
                                                    HorizontalAlignment="Right">
                                            <RadioButton Content="Text"
                                                         GroupName="{Binding ModeGroupName}"
                                                         IsChecked="{Binding IsTextMode, Mode=TwoWay}"
                                                         IsEnabled="{Binding CanEditAsText}" />
                                            <RadioButton Content="Hex"
                                                         GroupName="{Binding ModeGroupName}"
                                                         IsChecked="{Binding IsHexMode, Mode=TwoWay}" />
                                        </StackPanel>
                                        <TextBox Grid.Row="1" Grid.ColumnSpan="2"
                                                 Text="{Binding EditorValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 FontFamily="{Binding EditorFontFamily}"
                                                 AcceptsReturn="{Binding EditorAcceptsReturn}"
                                                 TextWrapping="Wrap"
                                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                 MinHeight="56" />
                                        <TextBlock Grid.Row="2"
                                                   Grid.ColumnSpan="2"
                                                   Text="{Binding ValidationError}"
                                                   Foreground="{DynamicResource ThemeAccentBrush}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
